# 実装計画ガイド

本ガイドは、cbプロジェクトの**実装計画**を作成する際の規約を定めたものです。

---

## 1. 目的

このディレクトリ（`docs/plans/`）は、以下を目的とした実装計画ドキュメントを格納します:

| 目的 | 説明 |
|------|------|
| **ギャップ分析** | 設計書と実装の差分、不足している機能を特定 |
| **実装優先度付け** | 必要な実装を優先度順に整理 |
| **実装スコープ定義** | 各実装タスクの範囲と成果物を明確化 |
| **チーム作業計画** | エージェント間での作業分担と依存関係を管理 |

---

## 2. ディレクトリ構成

```
docs/plans/
├── GUIDE.md                          # 本ガイド
├── TEMPLATE.md                       # テンプレートファイル
├── {NNN}-{title}.md                  # 進行中の実装計画
└── resolved/                         # 完了済み実装計画
```

### ライフサイクル

1. **アクティブ**: `docs/plans/` 直下に配置
2. **完了**: `docs/plans/resolved/` に移動

```bash
# 実装計画を完了済みにする
mv docs/plans/001-feature-name.md docs/plans/resolved/
```

- 番号とファイル名はそのまま維持（リネームしない）
- 完了済み実装計画の内容は編集不要（完了時点の状態を保持）

### ファイル命名規則

**形式**: `{番号}-{kebab-case-タイトル}.md`

| 要素 | 規則 | 例 |
|------|------|-----|
| 番号 | 3桁ゼロ埋め | `001`, `002`, `003` |
| タイトル | kebab-case、英語、簡潔 | `clipboard-monitoring` |

**番号の採番**:
- 新規計画は既存の最大番号 + 1
- 欠番は埋めない

---

## 3. 実装計画の種別

実装計画の種別は、各ファイルのHTMLコメント内の`種別`フィールドで管理します。

| 種別 | 説明 | 例 |
|------|------|----|
| `bugfix` | バグ修正のための実装計画 | クリップボード監視の停止修正 |
| `missing_docs` | 不足している設計書の作成計画 | モジュール設計書作成 |
| `enhancement` | 新機能・機能強化の実装計画 | 画像プレビュー機能 |
| `refactoring` | リファクタリング計画 | モジュール分割、テスト改善 |

---

## 4. ドキュメント構成

### 必須セクション

| セクション | 説明 |
|------------|------|
| **概要** | 実装の目的と背景を1-2段落で要約 |
| **実装スコープ** | 対応範囲と対応外を明確化（`対応範囲 ✅` / `対応外 ❌`） |
| **実装タスク** | 具体的なタスクリストと担当・依存関係 |
| **成功基準** | 受け入れ条件（テスト・検証方法） |

### 種別ごとの推奨セクション

| セクション | bugfix | missing_docs | enhancement | refactoring |
|------------|--------|--------------|-------------|-------------|
| 概要 | **必須** | **必須** | **必須** | **必須** |
| 現状分析 | **必須** | 任意 | 任意 | **必須** |
| 設計判断 | 任意 | 不要 | **必須** | **必須** |
| 実装スコープ | **必須** | **必須** | **必須** | **必須** |
| 実装タスク | **必須** | **必須** | **必須** | **必須** |
| 詳細実装内容 | 任意 | 任意 | **必須** | 任意 |
| テスト計画 | **必須** | 任意 | **必須** | **必須** |
| 成功基準 | **必須** | **必須** | **必須** | **必須** |
| 依存関係 | 任意 | 任意 | 任意 | 任意 |
| リスクと緩和策 | 任意 | 不要 | 任意 | 任意 |
| 関連ドキュメント | 任意 | 任意 | 任意 | 任意 |

**不要なセクションは削除**してください。空のセクションを残さないこと。

---

## 5. 記法規約

### 5.1 メタデータコメント

各実装計画ファイルの冒頭に以下のHTMLコメントを記載:

```markdown
<!--
種別: enhancement
優先度: 高
作成日: 2026-02-15
担当: メインセッション
状態: 🏃 進行中
-->
```

| フィールド | 必須 | 値 |
|-----------|------|----|
| 種別 | **必須** | `bugfix`, `missing_docs`, `enhancement`, `refactoring` |
| 優先度 | **必須** | `高`, `中`, `低` |
| 作成日 | **必須** | `YYYY-MM-DD` |
| 担当 | 任意 | 自由記述 |
| 状態 | 任意 | `⏳ 未着手`, `🏃 進行中`, `✅ 完了`, `⛔ ブロック中` |

### 5.2 タスクID規約

**形式**: `#{ファイル番号}-{連番}`

| 要素 | 規則 | 例 |
|------|------|-----|
| ファイル番号 | 実装計画の番号（3桁） | `001`, `002` |
| 連番 | 01から開始、2桁ゼロ埋め | `01`, `02`, `15` |

### 5.3 タスクリスト

```markdown
## 実装タスク

| タスクID | タスク名 | 説明 | 担当 | 依存 | 見積もり | 状態 |
|---------|---------|------|------|------|---------|------|
| 001-01 | Xcodeプロジェクト作成 | Swift Package構成の初期セットアップ | - | - | 1時間 | ⏳ 未着手 |
| 001-02 | クリップボード監視実装 | NSPasteboardの変更監視 | - | 001-01 | 2時間 | ⏳ 未着手 |
```

**状態記号**:
- ⏳ 未着手
- 🏃 進行中
- ✅ 完了
- ⛔ ブロック中

### 5.4 スコープ境界

```markdown
## 実装スコープ

### 対応範囲 ✅
- [x] クリップボード監視
- [x] テキスト履歴保存
- [ ] 画像履歴保存

### 対応外 ❌
- ファイルの一時保存（スコープ外）
- クラウド同期（スコープ外）
```

### 5.5 関連ドキュメントリンク

相対パスでリンク:

```markdown
**背景**:
- [設計書: クリップボードマネージャー](../design/modules/clipboard-manager.md)
- [ユースケース: クリップボード操作](../usecases/clipboard.md)
```

---

## 6. AIエージェント向けルール

### 6.1 調査の深さ

実装計画作成時は、**必要最小限の調査**で計画を立てる。

**原則**: 実装計画は「何を実装するか」を定義するものであり、「どう実装するか」の詳細は実装フェーズで決定する。

### 6.2 種別の選択基準

| 種別 | 選択基準 |
|------|----------|
| `bugfix` | 既存機能の不具合修正、期待動作との不一致を解消 |
| `missing_docs` | 実装済みだがドキュメント未整備のモジュール・機能を文書化 |
| `enhancement` | 新機能追加、既存機能の拡張（破壊的変更なし） |
| `refactoring` | 内部構造の改善、技術的負債の解消（外部挙動は不変） |

迷った場合は `enhancement` を選択し、メタデータコメントに判断理由を記載する。

---

## 7. 品質チェックリスト

- [ ] **ファイル名**: 命名規則に従っている（`{3桁番号}-{kebab-case}.md`）
- [ ] **メタデータ**: 種別・優先度・作成日が記載されている
- [ ] **明確性**: 実装スコープが明確に定義されている
- [ ] **完全性**: 必要なタスクが全て列挙されている
- [ ] **実現可能性**: タスクが実行可能なサイズに分割されている
- [ ] **依存関係**: タスク間の依存関係が正しく定義されている
- [ ] **成功基準**: 受け入れ条件が具体的に記述されている
- [ ] **リンク**: 関連設計書・ユースケースへのリンクが正しい

---

## 8. テンプレートの使用

新しい実装計画を作成する際は、[TEMPLATE.md](./TEMPLATE.md) をベースにしてください。

```bash
cp docs/plans/TEMPLATE.md docs/plans/001-feature-name.md
```

種別に応じて不要なセクションを削除し、必要なセクションを埋めてください（セクション4の表を参照）。

---

## 9. 参考資料

- [設計書作成ガイド](../design/GUIDE.md): 設計書の規約
