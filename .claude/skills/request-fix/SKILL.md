---
name: request-fix
description: レビュー結果を分類し、ユーザー判断を仰ぎ、修正をサブエージェントで実行する。引数にレビュー結果またはコンテキストから取得。
allowed-tools: Read, Grep, Glob, Task, AskUserQuestion
---

# 修正リクエスト

レビュー結果の指摘を分類し、必要な判断をユーザーに仰ぎ、修正をサブエージェントに委譲する。

## Step 1: 指摘の分類

レビュー結果の「Critical」「Medium」「Low」の **全項目** を以下に分類する。

| レビューレベル | 対応方針 |
|--------------|---------|
| **Critical** | 原則「即修正」。要判断の条件に該当する場合のみユーザー確認 |
| **Medium** | 内容に応じて「即修正」「要判断」「スキップ」に分類 |
| **Low** | 原則「記録」（残タスクに記録）。ユーザーが希望すれば対応 |

| カテゴリ | 条件 | 対応 |
|---------|------|------|
| **即修正** | 修正内容が一意に定まり、副作用リスクが低い | 修正リストに追加 |
| **要判断** | ユーザーの意思決定が必要（下記参照） | AskUserQuestion で確認 |
| **記録** | Low レベルの将来提案 | 残タスクに記録 |
| **スキップ** | 指摘が事実と異なる（既に対応済み等） | 理由を明記 |

### 要判断の条件

以下のいずれかに該当:

- **修正方法の選択**: 複数の修正方法がある、指摘が曖昧で解釈が分かれる
- **影響範囲**: 公開API・型定義・プロトコルの変更、複数モジュールにまたがる変更
- **技術選定・設計判断**: ライブラリの追加・変更、アーキテクチャ変更、技術スタック（CLAUDE.md）からの逸脱
- **スコープ**: PRスコープを超える可能性、大規模リファクタリングの誘発

## Step 2: ユーザー確認

「要判断」の指摘がある場合、AskUserQuestion で確認する（1回最大4問、5件以上は分割）。

指摘の性質に応じて選択肢を構成する:

**修正方法:** `options: [方法A, 方法B, スキップ]`
**技術選定:** `options: [選択肢A, 選択肢B, 現状維持]`
**スコープ:** `options: [このPRで対応, 別PRで対応, 対応不要]`

## Step 3: 修正リスト作成

分類とユーザー判断に基づき、修正リストを作成する:

- 「即修正」項目 → 修正リストに含める
- 「要判断」でユーザーが修正を選択 → 選択された方法で修正リストに含める
- 「別PRで対応」→ 残タスクに記録
- 「記録」（Low）→ 残タスクに記録
- 「スキップ」「対応不要」→ 理由を記録

修正リストが空なら Step 5 へ。

## Step 4: 修正サブエージェント起動

```
Task({
  subagent_type: "general-purpose", model: "sonnet",
  name: "fixer", description: "レビュー指摘の修正実行",
  prompt: ".claude/skills/execute-fix/SKILL.md を読み、以下の修正リストを実行してください。\n\n{修正リスト}"
})
```

## Step 5: 結果報告

```markdown
## 修正サイクル結果

### 修正完了
- {修正内容一覧、なければ「なし」}

### スキップ
- {スキップ項目と理由、なければ「なし」}

### 残タスク（別PR先送り）
- {先送り項目、なければ「なし」}
```
